# Загрузка Linux
## Попасть в систему без пароля.
### Первый способ `init=/bin/sh`

Во время загрузки GRUB меню жамем `e` и переходим к редактированию параметров загрузки.

В конце строки, начинающуюся с `linux16` дописываем `init=/bin/sh` и жмем `сtrl-x`.

рис 1-1-1

Перемонтируем файловую систему с правами записи: 
```
mount -rw -o remount /
```

После чего проверяем выполнив команду 

```
mount | grep root
``` 

или создав файл.

рис 1-1-2

### Второй способ `rd.break`

Во время загрузки GRUB меню жамем `e` и переходим к редактированию параметров загрузки.

В конце строки, начинающуюся с `linux16` дописываем `rd.break` и жмем `сtrl-x` (проваливаемся в emergency mode).

Перемонтируем корневую файловую систему с правами записи
```
mount -rw -o remount /sysroot
```

Выполняем операцию изменения корневого каталога 
```
chroot /sysroot
```

При помощи команды `passwd root` пароль для `root`.

Обновляем контекст SELinux 
```
touch /.autorelabel
```

рис 1-1

Перегружаем машину и входим с новым паролем.

### Третий способ `rw init=/sysroot/bin/sh`

Во время загрузки GRUB меню жамем `e` и переходим к редактированию параметров загрузки.

В конце строки, начинающуюся с `linux16` заменāем `ro` на `rw init=/sysroot/bin/sh` и жмем `сtrl-x` .

Дальше как во втором примере с той разницей, что ыайловая система сразу монтируется в режиме записи. 

## Установить систему с LVM, после чего переименовать VG

Проверяем исходное слостояние командой `vgs` и меняем имя VG командой 
```
vgrename centos OtusHW7
```

рис 1-2

Редактируем файлы: /etc/fstab, /etc/default/grub, /boot/grub2/grub.cfg. Меняе везде название старой VG `centos` на новое `OtusHW7`.

Пересобираем `initrd image` с новыми параметрами командой 
```
mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
```

Перезагружаемся и проверяем результат.

рис 1-3

## Добавить модуль в initrd

В каталог, где хранятся скрипты модулей `/usr/lib/dracut/modules.d/` добавляем тестовый каталог `01test` и в него помещаем два срипта:

`module-setup.sh` - устанавливает модулþ и вýзýвает скрипт `test.sh`

```
#!/bin/bash

check() {
    return 0
}

depends() {
    return 0
}

install() {
    inst_hook cleanup 00 "${moddir}/test.sh"
}
```

`test.sh` - вызываемый скрипт, который выводит сообщение и делает паузу вывода на 10 секунд

```
#!/bin/bash

exec 0<>/dev/console 1<>/dev/console 2<>/dev/console
cat <<'msgend'
Hello! You are in dracut module!
 ___________________
< Hello OTUS 2023!!! >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/
msgend
sleep 10
echo " continuing...."
```

Пересобираем `initrd image` с новыми параметрами командой 
```
mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
```
Перегружаемся.

Во время загрузки GRUB меню жамем `e` и переходим к редактированию параметров загрузки.

В строке, начинающуюся с `linux16` убираем параметры `rghb` и `quiet` и жмем `сtrl-x` .

Смотрим вывод

рис 2-1

